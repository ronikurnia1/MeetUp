<ion-header>
    <ion-toolbar no-border>
        <ion-buttons left>
            <button clear color="primary" ion-button icon-only (click)="openMeetingTracker($event)">
                <ion-icon name="list-box"></ion-icon>
            </button>
        </ion-buttons>
        <ion-title>My Schedule</ion-title>
        <ion-buttons right>
            <button clear color="primary" ion-button icon-only (click)="arrangeMeeting($event)">
                <ion-icon name="add-circle"></ion-icon>
            </button>
        </ion-buttons>
    </ion-toolbar>
    <ion-segment [(ngModel)]="section">
        <ion-segment-button value="my-schedule">
            My Schedule
        </ion-segment-button>
        <ion-segment-button value="invitations">
            Invitations
        </ion-segment-button>
        <ion-segment-button value="hosting">
            Hosting
        </ion-segment-button>
    </ion-segment>
    <ion-toolbar no-border>
        <ion-searchbar [value]="filterInvitation" (ionInput)="filterInvitations($event)" *ngIf="section === 'invitations'"></ion-searchbar>
        <ion-searchbar [value]="filterHosting" (ionInput)="filterHostings($event)" *ngIf="section === 'hosting'"></ion-searchbar>
        <p class="primary-title" *ngIf="section === 'my-schedule'">{{scheduleDate}}</p>
        <p class="secondary-title" *ngIf="section === 'my-schedule'">You have {{totalMeeting}}</p>
        <button no-lines (click)="viewCalendar($event)" icon-only large ion-button clear icon-left *ngIf="section === 'my-schedule'">
            <ion-icon name="calendar"></ion-icon>
        </button>
    </ion-toolbar>
</ion-header>
<ion-content padding>

    <div [ngSwitch]="section">
        <ion-list *ngSwitchCase="'my-schedule'">
            <ion-item *ngFor="let meeting of schedules" (click)="toggleMeeting(meeting)" class="meeting">
                <div bp-layout="flex margin-bottom">
                    <div bp-layout="fit margin-right--sm">{{meeting.time}}</div>
                    <div bp-layout="fill margin-left--sm">
                        <div class="bold-text wrap-text">{{meeting.subject}}</div>
                        <div *ngIf="meeting.type==='meeting'" bp-layout="margin-top--sm" class="wrap-text">Venue: {{meeting.location}}</div>
                    </div>
                </div>
                <div bp-layout="flex" *ngIf="meeting.isExpanded && meeting.type==='meeting'">
                    <div bp-layout="fit margin-left margin-right">
                        <ion-avatar item-left>
                            <img [src]="meeting.meetingWith.avatar">
                        </ion-avatar>
                    </div>
                    <div bp-layout="fill margin-left--sm">
                        <div class="bold-text wrap-text">{{meeting.meetingWith.title}} {{meeting.meetingWith.fullName}}</div>
                        <div class="wrap-text">{{meeting.meetingWith.company}}&nbsp;</div>
                        <div class="wrap-text">{{meeting.meetingWith.country}}&nbsp;</div>
                    </div>
                </div>
                <div bp-layout="flex margin-bottom" *ngIf="meeting.isExpanded && meeting.type==='meeting'">
                    <div class="bold-text" margin-top>Remarks</div>
                    <div class="wrap-text">{{meeting.remarks}}</div>
                </div>
                <div bp-layout="row center margin-bottom" *ngIf="meeting.isExpanded && meeting.type==='meeting'">
                    <ion-buttons>
                        <button ion-button clear icon-only class="text-on-bottom" (click)="rescheduleMeeting(meeting)">
                            <ion-icon name="time"></ion-icon>
                            <span ion-text color="primary">Reschedule</span>
                        </button> &nbsp;&nbsp;&nbsp;
                        <button ion-button clear icon-only class="text-on-bottom" (click)="withdrawAcceptedMeeting(meeting)">
                            <ion-icon color="danger" name="remove-circle"></ion-icon>
                            <span ion-text color="danger">Cancel Meeting</span>
                        </button>
                    </ion-buttons>
                </div>
            </ion-item>
        </ion-list>

        <ion-list *ngSwitchCase="'invitations'">
            <ion-item *ngFor="let meeting of invitations" (click)="viewMeetingDetails(meeting, 'invitation')" class="meeting">
                <div bp-layout="flex">
                    <ion-avatar item-left bp-layout="fit margin-right--sm">
                        <img [src]="meeting.meetingWith.avatar">
                    </ion-avatar>
                    <div bp-layout="fill margin-left--sm">
                        <div class="wrap-text bold-text">{{meeting.meetingWith.title}} {{meeting.meetingWith.fullName}}</div>
                        <div class="wrap-text">{{meeting.subject}}</div>
                        <div class="wrap-text">{{getDateFormated(meeting.date,'DD MMMM YYYY')}}, {{meeting.time}}</div>
                    </div>
                </div>
                <div bp-layout="row center margin-top--sm margin-bottom--sm">
                    <ion-buttons>
                        <button ion-button clear icon-only (click)="acceptMeeting(meeting)">
                            <ion-icon name="checkbox-outline" color="green"></ion-icon>
                            <span ion-text color="green">Accept</span>
                        </button> &nbsp;&nbsp;&nbsp;
                        <button ion-button clear icon-only (click)="declineMeeting(meeting)">
                            <ion-icon color="danger" name="close-circle"></ion-icon>
                            <span ion-text color="danger">Decline</span>
                        </button>
                    </ion-buttons>
                </div>
            </ion-item>
        </ion-list>

        <ion-list *ngSwitchCase="'hosting'">
            <ion-item *ngFor="let meeting of hostings" (click)="viewMeetingDetails(meeting, 'hosted')" class="meeting">
                <div bp-layout="flex">
                    <ion-avatar item-left bp-layout="fit margin-right--sm">
                        <img [src]="meeting.meetingWith.avatar">
                    </ion-avatar>
                    <div bp-layout="fill margin-left--sm">
                        <div class="wrap-text bold-text">{{meeting.meetingWith.title}} {{meeting.meetingWith.fullName}}</div>
                        <div class="wrap-text">{{meeting.subject}}</div>
                        <div class="wrap-text">{{getDateFormated(meeting.date,'DD MMMM YYYY')}}, {{meeting.time}}</div>
                    </div>
                </div>
                <div margin-top margin-bottom bp-layout="row center">
                    <ion-buttons>
                        <button ion-button clear icon-only class="text-on-bottom" (click)="rescheduleMeeting(meeting)">
                            <ion-icon name="time"></ion-icon>
                            <span ion-text color="primary">Reschedule</span>
                        </button> &nbsp;&nbsp;&nbsp;
                        <button ion-button clear icon-only class="text-on-bottom" (click)="cancelMeeting(meeting)">
                            <ion-icon color="danger" name="remove-circle"></ion-icon>
                            <span ion-text color="danger">Cancel</span>
                        </button>
                    </ion-buttons>
                </div>
            </ion-item>
        </ion-list>
    </div>

    <ion-fab bottom right *ngIf="showScanBadge">
        <button ion-fab mini (click)=scanQrCode()><ion-icon name="qr-scanner"></ion-icon></button>
    </ion-fab>
</ion-content>